\section{Kubo Formula}
We'll derive the Kubo formula for a general, multi-particle (or, if you prefer, single particle) Hamiltonian $H_0$ where the subscript 0 means that this is the unperturbed Hamiltonian before we apply an electric field. We denote the eigentstates of the Hamiltonian as $\ket m$ with $H_0\ket m=E_m \ket m$.
\begin{equation}
    H_0=\sum_i\left[\frac{1}{2m}\left(\vect p_i-e\vect A_0\right)^2 + V_0(\vect r_i)\right]+\sum_{i\neq j}V_{ee}(\vect r_i-\vect r_j)
\end{equation}
Where $\vect A_0$ and $V_0$ are due to an existing EM field. Now we add a background electric field. We 
\begin{equation}
    H=\sum_i\left[\frac{1}{2m}\left(\vect p_i-e\vect A_0 - e\vect A\right)^2 + V_0(\vect r_i) - e\vect r_i\phi(\vect r_i)\right]+\sum_{i\neq j}V_{ee}(\vect r_i-\vect r_j)
\end{equation}
Which can be written as 
\begin{equation}
    H=H_0 + \sum_{i}-\frac{e}m \boldsymbol \pi_i\cdot \vect A - e\vect r_i\phi(\vect r_i)
    \label{eq:temp_ham}
\end{equation}
Where $\boldsymbol \pi_i=\vect p -e\vect A_0=m\dot{\vect r}$ is the mechanical momentum,
furthermore we can use the fact that the electric charge operator $\rho(\vect r)=-e\sum_{i}\delta(\vect r-\vect r_i)$ current operator  $\vect I$ is equal to 
\begin{equation}
    \vect I=-e\sum_{i}\dot{\vect r}_i=-\sum_{i}\frac{e}m \boldsymbol \pi_i
\end{equation}
to re-write equation \ref{eq:temp_ham} like so
\begin{equation}
    H=H_0+\vect I\cdot \vect A + \int\rho(\vect r)\phi(\vect r)d\vect r
\end{equation}
however, we can assume that the density of charge $\rho$ is always zero (it is usually considered when investigating dielectric properties of a material, but here we are interested in conduction, so we are ignoring it)
\begin{equation}
    H(\vect A)=H_0+\vect I\cdot \vect A
    \label{eq:deltaH}
\end{equation}
At this point we need to write the perturbation in terms of the electric field, we can choose a gauge where $\vect E=-\partial_t\vect A$ and assume that the wave is monochromatic $\vect E(t)=\vect Ee^{-i\omega t}$, so 
\begin{equation}
    A=\frac{ \vect E}{i\omega}e^{i\omega t}
    \label{eq:A(E)}
\end{equation}
Our goal is to compute the current $\langle \vect I\rangle$ that flows due to the perturbation $\Delta H$. To do so we'll work in the \textit{interaction picture}, this means that the operators evolve as $\mathcal O(t)=V^{-1}\mathcal O V$ with $V=e^{-iH_0t/\hbar}$. This means that the states evolve by 
\begin{equation}
    \ket{\psi(t)}=U(t,t_0)\ket{\psi(t_0)}; \quad 
    U(t,t_0)=T\exp\left(-\frac i\hbar \int_{t_0}^t\Delta H(t')dt'\right)
    \label{eq:int evol}
\end{equation}
Where $T$ is the time ordering, keep in mind that since we are in the interaction picture $\Delta H(t)=V^{-1}\Delta HV$.\\
We now prepare the system at time $t=-\infty$ in a specific many body state $\rho_0=\sum_i p_i\ket{i}\bra{i}$ (it usually is either the ground state or a thermodynamic distribution). Keep in mind that the density operator, in the interaction picture evolves with the states
\begin{equation}
\begin{split}
        \rho(t)&=\sum_ip_i\ket{\psi_i(t)}\bra{\psi_i(t)}=\\
        &0=\sum_ip_iU(t,t_0)\ket{\psi_i(t_0)}\bra{\psi_i(t_0)}U^{-1}(t,t_0)=\\
        &=U(t,t_0)\rho(t_0)U^{-1}(t,t_0)
\end{split}
\end{equation}
Then, writing $U(t)=T(t,t_0\to-\infty)$, the expectation value of the current is
\begin{equation}
    \begin{split}
        \langle \vect I(t)\rangle &= \tr\left[\rho(t)\vect I(t)\right]=\\
        &=\tr\left[U(t)\rho_0 U^{-1}(t) \vect I(t)\right]=\\
        &=\tr\left[\rho_0 U^{-1}(t) \vect I(t)U(t)\right]=\\
        &=\langle U^{-1}(t) \vect I(t)U(t)\rangle_{0}\approx\\
        &\approx\left\langle\vect I(t)\right\rangle_{0} +
        \left\langle \frac i\hbar \int_{-\infty}^t[\Delta H(t'),\vect I(t)]dt'\right\rangle_0
    \end{split}
\end{equation}
Where in the last passage we've expanded the exponential in the $U$ operator (equation \ref{eq:int evol}), and $\langle \dots\rangle_0$ means the average with respect to $\rho_0$. The first term is the current in the absence of an electric field, therefore it is zero. Using equation \ref{eq:deltaH} and \ref{eq:A(E)} and plugging it in the last equation we have that the current due to the electric field is then
\begin{equation}
    \langle I_i(t)\rangle=\frac 1{\hbar\omega}\int_{\infty}^t
    \langle[I_j(t'),I_i(t)]\rangle_0 E_je^{-i\omega t'}dt'
\end{equation}
Because the system is invariant under time translations, the correlation function above can bony depend on $t''=t-t'$, we can rewrite the expression above as
\begin{equation}
    \frac{E_je^{-i\omega t}}{\hbar \omega}\int_0^{\infty}e^{i\omega t''} \langle[I_j(0),I_i(t'')]\rangle_0 dt''
\end{equation}.
The only t dependence in the formula above sits outside as $e^{-i\omega t}$. This means that the proportionality constant is the conductance. To get the conductivity $\sigma$ (conductance per unit area, we just have to divide the surface $S$), and the off diagonal part is the \textit{Hall conductivity}
\begin{equation}
    \sigma_{xy}=\frac 1{S\hbar \omega}\int_0^{\infty}e^{i\omega t} \langle[I_x(0),I_y(t)]\rangle_0 dt
    \label{eq:kubo}
\end{equation}
This is the \textit{Kubo formula} for the Hall conductivity.













\section{Quantization of Hall conductivity}
Our job here is not done, we got Kubo formula the Hall conductivity \ref{eq:kubo}, but to capture the most important property we need to do some mathematical manipulation. Using the fact hat $\vect I(t)=V^{-1}\vect I(0) V$ with $V=e^{-iH_0t/\hbar}$ we can write
\[
    \sigma_{xy}(\omega)=\frac 1{S\hbar \omega}\int_0^{\infty}e^{i\omega t}\sum_{nm}p_n
    \left[
        \braket{n|I_y}{m}\braket{m|I_x}{n}e^{-iE_{nm}t/\hbar}-(n\leftrightarrow m) %\braket{n|J_x}{m}\braket{m|J_y}{n}e^{i(E_n-E_m)t/\hbar}
    \right]
    dt
\]
Now we can perform the integral in $dt$, since the states with $n=m$ cancel out we have that
\begin{equation}
    \sigma_{xy}(\omega)=-\frac i{\omega S} \sum_{nm}p_n\left[
        \frac{\braket{n|I_y}{m}\braket{m|I_x}{n}}{\hbar \omega - E_{nm}} - (n\leftrightarrow m)
    \right]
\end{equation}
To get the Hall conductivity for DC current we have to evaluate $\sigma_{xy}(\omega\to 0)$, in this limit
\[
    \lim_{\omega\to 0}\frac{1}{\hbar \omega-E_{nm}}=-\frac 1{E_{nm}}+\frac{\hbar \omega}{(E_{nm})^2}    
\]
Plugging the zeroth-order we get
\begin{equation}
    \begin{split}
    \sigma_{xy}=&\frac i{\omega S} \sum_{nm}p_n\left[
        \frac{\braket{n|I_y}{m}\braket{m|I_x}{n}}{E_{nm}} - (n\leftrightarrow m)
    \right]= \\
    =&\frac i{\omega S}\sum_{nm}\frac{p_n}{E_{nm}}\left[
        \braket{n|I_y}{m}\braket{m|I_x}{n} + (n\leftrightarrow m)
    \right]=\\
    =&0
    \end{split}
\end{equation}
That is equal to zero because the terms inside the summation are asymmetric under the exchange of $(n\leftrightarrow m)$, and we are summing over all the possible $n$ and $m$. For the first order term we have
\begin{equation}
    \sigma_{xy}=\frac{i\hbar}S\sum_{nm}\frac{p_n}{(E_{nm})^2}\left[
        \braket{n|I_y}{m}\braket{m|I_x}{n} - (n\leftrightarrow m)
    \right]
    \label{eq:kkubo}
\end{equation}

From equation \ref{eq:deltaH} we can see that $I_i=\partial H/\partial A_i$, this means that the equation above becomes
\begin{equation}
    \begin{split}
        \sigma_{xy}=&
        \frac{i\hbar}S\sum_{nm}\frac{p_n}{(E_{nm})^2}\left[
        \braket{n|I_y}{m}\braket{m|I_x}{n} - (n\leftrightarrow m)
    \right]=\\
    =&\frac \hbar S\sum_{n}p_n\sum_{m\neq n}\frac{i}{(E_{nm})^2}\left[
    \braket{n\bigg|\frac{\partial H}{\partial A_y}}{m}\braket{m\bigg|\frac{\partial H}{\partial A_x}}{n} - (n\leftrightarrow m)
    \right]=\\
    =&\frac \hbar S\sum_{n}p_n\Omega^n_{A_xA_y}
    \end{split}
\end{equation}
This is a nice formula, however it doesn't explain why $\sigma_{xy}$ is quantized, however if we average over all possible values of $\vect A$, which comes from all the possible value of the fluxes

\begin{equation}
    \begin{split}
        \langle\sigma_{xy}\rangle=&
        \frac{\int \sigma_{xy}d^2\vect A}{\int d^2\vect A}=\\
        =&\left(\frac{S}{\Phi_0^2}\right)\frac \hbar S\sum_np_n\int \Omega^n_{A_xA_y}d^2\vect A =\\
        =&\left(\frac{e^2}{4\pi^2\hbar^2}\right)2\pi\hbar\sum_np_nC_n=\\
        =&\frac{e^2}{2\pi\hbar}\sum_np_nC_n\quad \quad \text{with }C_n\in \mathbb Z
    \end{split}
    \label{eq:quantized sigma}
\end{equation}
Where we have defined the Chern numbers $2\pi C_n=\int \Omega^n_{A_xA_y}d^2\vect A$ and for the Stokes theorem it is a multiple of $1$. The most emblematic passage here is why $\int d^2\vect A=\Phi_0^2/S$.\\

\subsubsection*{$\boldsymbol{\sigma_{xy}}$ at low temperatures}
In equation \ref{eq:quantized sigma} we had a contribution that is the average of $C_n$ over all the states, if we are at low temperature there are two possibilities depending on the treatment we had on the wavefunction
\begin{itemize}
    \item \textbf{Many body interacting wavefunction} For $T\to 0$ we have that it will be at the fundamental state $p_0\to1$ and $p_i\to 0$ for $i\neq 0$, this means that $\sum_np_nC_n\to C_0$, therefore a quantized conductivity quill be observed
    \item \textbf{Non-interacting single particle wavefunctions} For $T\to 0$ the electrons will settle in a Fermi-Dirac distribution, so \[\sum_np_nC_n=N^{-1}\sum_nC_n\theta(E_F-E_n)\] where $N$ is the total number of electrons and $E_F$ is the Fermi energy. Although it's not as easy to prove that is generally quantized due to the $N^{-1}$ factor,\footnote{Even thought we know for sure it must be quantized, because we can always re-parametrize Non-interacting single particle wavefunctions into many body interacting wavefunction} we'll see that it's much easier to calculate the precise value for real world scenarios, and it's going to be the subject of the next section
\end{itemize}



















\section{Berry phase in Bloch bands}
The band structure of crystals provides a natural platform to investigate the occurrence of the berry phase effect. Within the independent electron approximation, the band structure of a crystal is determined by the Bloch Hamiltonian:
\begin{equation}
    H= \frac {\vect p^2}{2m} + V(\vect r)
\end{equation}
Where $V(\vect r+\vect a)=V(\vect r)$ is the periodic potential with $a$ being the Bravais lattice vector. According to Bloch's theorem the eigenstates satisfy 
\begin{equation}
    \psi_{n\vect k}(\vect r+\vect a)=e^{i\vect k\cdot \vect a}\psi_{n\vect k}(\vect r)
\end{equation}
where $n$ is the band index and $\hbar \vect k$ is the crystal momentum. To comply with the general formalism of the Berry phase, we make the following unitary transformation to obtain a $\vect k$-dependent Hamiltonian

\begin{equation}
    e^{-i\vect k\cdot \vect r}He^{i\vect k\cdot \vect r}= H= \frac {(\vect p+\hbar \vect k)^2}{2m} + V(\vect r)
\end{equation}
The transformed eigenstate $u_{n\vect k}(\vect r)= e^{-i\vect k\cdot \vect r}\psi_{n\vect k}(\vect r)$ is just the cell-periodic part of the Bloch function. It satisfies the strict periodic boundary condition 
\begin{equation}
    u_{n\vect k}(\vect r+\vect a)=u_{n\vect k}(\vect r)
\end{equation}
We can now identify the Brillouin zone as the parameter space of the transformed Hamiltonian $H(\vect k)$, and $u_{n\vect k}=\ket{n,\vect k}$ as the basis function.\\
In this regime the Kubo formula \ref{eq:kkubo} becomes 
\begin{equation}
    \sigma_{xy}=i\hbar\sum_{m,E_n<E_F}\int_{T^2}
    \frac{
        \braket{n,\vect k|J_y}{m,\vect k}\braket{m,\vect k|J_x}{n,\vect k} - (n\leftrightarrow m)
    }
    {
        E_m(\vect k)-E_n(\vect k)
    }
    \frac{d^2\vect k}{(2\pi)^2}
    \label{eq:tknn}
\end{equation}
And it is called the TKNN formula \cite{thouless1982quantized}

We can define the current in terms of the group velocity of the wavepackets
\begin{equation}
    \vect J=\frac e\hbar \frac{\partial H}{\partial \vect k}
\end{equation}
this means that equation \ref{eq:tknn} is equal to
\begin{equation}
    \frac{e^2}{2\pi\hbar}\sum_{n}C_n
\end{equation}
where $C_n$ is the Chern number of the $n$-th band















