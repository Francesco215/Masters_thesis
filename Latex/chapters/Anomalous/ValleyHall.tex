\section{Valley-Hall effect}
The Hall conductivity $\sigma_{xy}$ is 
\begin{equation}
    \sigma_{xy}=\frac{e^2}\hbar \int_{\mathbb R^2} f[E^+(k)]\Omega^+_{k_xk_y}+f[E^-(k)]\Omega^-_{k_xk_y}\frac{d^2\vect k}{2\pi}
    \label{eq:valley-conductivity-1}
\end{equation}
Where $f(E)=\big[e^{\beta (E-\mu)}+1\big]^{-1}$ is the Fermi-Dirac distribution, it is applied once for the states with positive energy and once for the states with negative energy.

We are going to analyze the system at low temperatures ($k_\beta T\ll 1$), so our Fermi-Dirac distribution can be considered like a step-function.

First let's integrate the conductivity for the positive energies and drop the $+$ sign to make the notation lighter.

\[
    \int_{\mathbb R^2} f[E(k)]\Omega_{k_xk_y}dk_xdk_y=\int_{\mathbb R^2} f[E(q)]\Omega_{q_xq_y}dq_xdq_y\approx
\]

\[
    \approx\int_{0}^{2\pi}\int_{0}^{q_F}\frac12 \frac{\Delta^2}{q^2E^3}(q_x+q_y-2q)qdqd\theta=
\]

\[
    =-2\pi\Delta^2\int_0^{q_f}\frac{dq}{E^2} =-2\pi\Delta^2\int_0^{q_f}\frac{dq}{(\Delta^2+q^2)^{3/2}}= 
    -\frac{2\pi q_F}{\sqrt{\Delta^2+q_F^2}}
\]

And now we express it in terms of the chemical potential $\mu$ \footnote{Here we can use interchangeably $\mu$ and $E_F$}


\begin{equation}
    \int_{\mathbb R^2} f[E(k)]\Omega_{k_xk_y}dk_xdk_y\approx-2\pi \frac{\sqrt{\mu^2-\Delta^2}}\mu\theta(\mu-\Delta)
\end{equation}
The $\theta(\mu-\Delta)$ is there to make sure that if no states are inside the Fermi-Dirac the integral is zero. One thing to notice is that if you have $\mu \gg \Delta$ (aka. all states in the band are occupied) then the integral is equal to $-2\pi$. The integral of the lower band is very similar. By the end equation of the conductivity \ref{eq:valley-conductivity-1} becomes
\begin{equation}
    \sigma_{xy}(\mu)=-\frac {e^2}{2\pi \hbar}\Bigg[\frac{\sqrt{\mu^2-\Delta^2}}{\mu} \theta(\mu^2-\Delta^2) - \theta(\mu-\Delta)\Bigg]
    \label{eq:valley-conductivity-2}
\end{equation}
\begin{figure}
    \centering
    \includegraphics[width=\linewidth]{Immagini/ValleyHall/sigma_xy.eps}
    \caption{Here is shown $\sigma_{xy}(\mu)$ (eq. \ref{eq:valley-conductivity-2}). Notice how, when $\mu \in [-\Delta,\Delta]$ then $\sigma_{xy}=\frac {e^2}{2\pi \hbar}$}
    \label{fig:sigma_xy}
\end{figure}
To be fear we only calculated $\sigma_{xy}$ for the electrons in the valley $K_1$, the conductivity for the other valley is just $-\sigma_{xy}$. So, putting it all together, we have

\begin{equation}
    \sigma_{K_i,xy}(\mu)=(-1)^i\frac {e^2}{2\pi \hbar}\Bigg[\frac{\sqrt{\mu^2-\Delta^2}}{\mu} \theta(\mu^2-\Delta^2) - \theta(\mu-\Delta)\Bigg]
    \label{eq:valley-conductivity-complete}
\end{equation}
However in most cases it's safe to assume that the chemical potential is inside the energy gap, so equation \ref{eq:valley-conductivity-complete} becomes
\begin{equation}
    \sigma_{K_i,xy}=(-1)^{i+1}\frac {e^2}{2\pi \hbar}
\end{equation}



\section{Non-local Charge transport}
If we apply a voltage $V$ in two opposite points of a strip of a ohmic material of width $W$ and infinite lenght, and  we see a current that flows from one point to another figure \ref{fig:beconcini_strip}.\newline
\begin{figure}
    \centering
    \includegraphics[width=0.7\linewidth]{Immagini/ValleyHall/beconcini_strip.pdf}
    \caption{Representation of the strip}
    \label{fig:beconcini_strip}
\end{figure}
Clearly the current isn't completely localized along the axis that unites the two injection points, and so does the voltage difference.\newline
If we probe the voltage from two different points with an offset of $x$ from the injection points and we divide it by the total current between the contacts we see that  

\begin{equation}
    \frac{V(x)}I=\frac{2\rho}\pi\ln\bigg |\coth \Big(\frac{\pi x}{2W}\Big)\bigg |
    \label{eq:ohmic signal}
\end{equation}
Where $\rho$ is the resistivity. Don't worry later on there is the proof of this equation.\newline

However, two-dimentional material like gapped graphene \cite{gorbachev2014detecting,sui2015gate,shimazaki2015generation} and transition metal dichalcogenides \cite{xiao2012coupled,mak2014valley,lee2017valley}, don't obey this equation. This is because theese materials display the Valley Hall effect we talked about previously (inserire reference a sezione).

Non-local transport can be a useful tool to probe the existance of anomalous Hall effect \cite{valenzuela2006direct,abanin2009nonlocal,brune2010evidence,abanin2011giant,balakrishnan2013g,wang2015proximity}


\section{Theory of non local charge transport}

The charges inside the material get pushed around from the electrochemical potential $\psi_K$


\begin{equation}
    \psi_{K}(\vect r)= V(\vect r)-\frac 1e \mu_K[n_{K_1}(\vect r),n_{K_2}(\vect r),T]
\end{equation}

Where $\phi$ is the electrical potential, and $\mu_K=\frac {\partial}{\partial n_{K}}F[n_{K_1}(\vect r),n_{K_2}(\vect r),T]$ is the chemical potential of the material and $F$ is the free energy.

The current generated from this potential in the valley $K_\alpha$ in the $i-$th direction is

\begin{equation}
    -eJ_{K_\alpha,i}(\vect r)= \sum_{j,b} \underbrace{-\sigma_{K_\alpha K_\beta ,ij}}_{\textrm{conductivity}}\partial_j\psi_{K_\beta }(\vect r)
\end{equation}
From now we are going to set $T\approx 0$\footnote{A more precise statement is that the thermal De Broglie wavelenght $\lambda_T$ must be much larger than the average distance between the electrons. We are not going into the math here, but if you want to calculate it, keep in mind that the dispersion relation is relativistic, so the formula of $\lambda_T$ is going to be a bit different}
and ignore intervalley scattering, so if $K_\alpha \neq K_\beta $ $\sigma_{K_\alpha K_\beta ,ij}=0$, also because of this the free energy can be written as the sum of the two Free energies
\begin{equation}
    F(n_{K_1},n_{K_2})=F_1(n_{K_1}(\mathbf r))+F_2(n_{K_2}(\mathbf r))
\end{equation}
And so the chemical potential of a given valley depend only on the number of electron in the same valley
\begin{equation}
    \mu_\alpha(n_{K_\alpha}(\mathbf r))=\frac{\partial}{\partial n_{K_\alpha}}F(n_{K_0},n_{K_1})=\frac{\partial}{\partial n_{K_\alpha}}F_\alpha(n_{K_\alpha}(\mathbf r))
\end{equation}
This simplifies the trasport equation in 

\begin{equation}
    -e\mathbf J_{K_{\alpha}}(\mathbf r)= \sigma_{K_\alpha}(\mathbf r)\nabla \psi_{K_\alpha}(\mathbf r)
    \label{eq:current-1}
\end{equation}
Where $\sigma_{K_\alpha}$ is the following matrix
\[
    \sigma_{K_\alpha}=
    \begin{bmatrix}
        \sigma_{K_\alpha K_\alpha,xx} & \sigma_{K_\alpha K_\alpha,xy}\\
        -\sigma_{K_\alpha K_\alpha,xy}^* & \sigma_{K_\alpha K_\alpha,xx}
    \end{bmatrix}
\]
Now we need to write the gradient electrochemical potential $\nabla \psi(\vect r)$
\begin{equation}
    \nabla \psi_{K_\alpha}(\mathbf r)=\nabla V(\mathbf r) -\frac 1e \frac{\partial}{\partial n_{K_\alpha}}\mu_\alpha(n_{K_\alpha}(\mathbf r))\nabla n_{K_\alpha}
    \label{eq:echemical1}
\end{equation}
From equation INSERIRE REFERENCE A EQUAZIONE we can write for gapped Dirac hamiltonians that VERIFICARE SE VALE ANCHE PER BILAYER GRAPHENE  \[\frac{\partial \mu_{K_\alpha}}{\partial n_{K_\alpha}}=\frac{\pi}{\sqrt{2\pi |n|+\Delta^2}}+\Delta\delta(n)\approx \frac \pi\Delta +\Delta\delta(n) \quad \forall \alpha\]
In this equation we assumed that there are very few charge carries, so $\frac n{\Delta^2}\approx 0$. We can shorten the equation \ref{eq:echemical1} by defining
\begin{equation}
    e^2D_{K_\alpha,ij}=\sigma_{K_\alpha, ij}\frac{\partial \mu_\alpha}{\partial n_{K_\alpha}}[n_{K_\alpha}(\mathbf r)]
\end{equation}
So equation \ref{eq:current-1} becomes

\begin{equation}
    -eJ_{K_\alpha,i}(\mathbf r)=\sigma_{K_\alpha, ij}E_j(\mathbf r) -eD_{K_\alpha,ij}\partial _jn_{K_\alpha}(\mathbf r)
\end{equation}
or, written in matrix form
\begin{equation}
    -e\mathbf J_{K_\alpha}(\mathbf r)=\sigma_{K_\alpha}\mathbf E(\mathbf r) -eD_{K_\alpha}\nabla n_{K_\alpha}(\mathbf r)
\end{equation}
Where $\sigma_{K_\alpha}$ and  $-eD_{K_\alpha}$ are matrices.

\subsection{Re-writing the equations in terms of charge current and valley current}
Measuring the currents in different valley can be cumbersome, however measuring the charge current $\mathbf J_{c}=\mathbf J_{K_1}+\mathbf J_{K_2}$ is straightforward, and for mathematical convenience we also define the valley current $\mathbf J_{v}=\mathbf J_{K_1}-\mathbf J_{K_2}$.

Since we no longer describe the currents in terms of their valley index, but on the sum and the difference of what happens at the different valleys, we are going to reparametrize also the other quantities in the same fashion.


\begin{equation}
    \begin{cases}
        \sigma_c=\sigma_{K_1}+\sigma_{K_2}=2\sigma_{xx}\delta_{ij}\\
        \sigma_v=\sigma_{K_1}-\sigma_{K_2}=\sigma_v=2\sigma_{xy}\epsilon_{ij}
    \end{cases}
\end{equation}
The term $-eD_{K_\alpha}\nabla n_{K_\alpha}(\mathbf r)$ is a little harder to traslate. First off we are going to impose the local charge conservation

\[
    n(\mathbf r)=n_{K_0}+n_{K_1}\approx 0
\]
and so 

\begin{equation}
    n_v(\mathbf r)=n_{K_1}-n_{K_2}=2n_{K_1}=-2n_{K_2}
\end{equation}
Now let's do the sum of the $D_{K_\alpha}\nabla n_{K_\alpha}(\mathbf r)$ terms to write them in terms of charge and valleys degrees of freedom

\[D_{K_1}\nabla n_{K_1}+D_{K_2}\nabla n_{K_2}=(D_{K_1}-D_{K_2})\nabla n_v(\mathbf r)/2\]

\[D_{K_1}-D_{K_2}=\sigma \frac{\partial \mu_1}{\partial n_{K_1}}- \sigma^T \frac{\partial \mu_2}{\partial n_{K_2}}\]
since $\mu_v=2\mu_1=-2\mu_2$ and $n_v=2n_{K_1}=-2n_{K_2}$

\[D_{K_1}-D_{K_2}=\frac 1{e^2}(\sigma-\sigma^T)\frac{\partial \mu_v}{\partial n_v}=\frac 2{e^2}\sigma_v\frac{\partial \mu_v}{\partial n_v}\]
so I define 

\[D_{cv}=\frac 2{e^2}\sigma_v\frac{\partial \mu_v}{\partial n_v}\approx\frac 2{e^2} \frac \pi\Delta\sigma_v\]
so we get that

\[D_{K_1}\nabla n_{K_1}+D_{K_2}\nabla n_{K_2}=D_{cv}n_v\]
Putting it all together we have that

\[\mathbf J_c(\mathbf r)=\sigma_c \mathbf E(\mathbf r)+eD_{cv}\nabla n_v(\mathbf r)\]
Writing all the indices

\begin{equation}
    J_{c,i}=\sum_j \sigma_{c,xx}\delta_{ij}E_i+D_{cv,xy}\epsilon_{ij}\partial_j n_v
\end{equation}
so we can rewrite them as


\begin{equation}
    \mathbf J_{c}= \sigma_{c,xx}\mathbf E_i + D_{cv,xy} \nabla \times n_v
    \label{eq:diff-jc}
\end{equation}
where $\sigma_{c,xx}$ and $D_{cv,xy}$ are scalars.

And now the difference of the $D_{K_\alpha}\nabla n_{K_\alpha}(\mathbf r)$ terms to write them in terms of charge and valleys degrees of freedom

\[D_{K_0}\nabla n_{K_0}-D_{K_1}\nabla n_{K_1}=(D_{K_0}+D_{K_1})\nabla n_v(\mathbf r)/2\]
and with some calculations done in a similar fashion to the one we use to calculate $\mathbf J_c$ we have that

\[D_v=\frac12(D_{K_0}+D_{K_1})=\frac 1{e^2}\sigma_c\frac{\partial \mu_c}{\partial n_c}\]
so, in matrix form


\begin{equation}
    \mathbf J_v(\mathbf r)=\sigma_v\mathbf E(\mathbf r)+eD_{v}\nabla n_v(\mathbf r)    
\end{equation}
which can be re-written as


\begin{equation}
    J_{v,i}(\mathbf r)=\sum_j \sigma_{c,xy} \epsilon_{ij}  E_j(\mathbf r)+eD_{v,xx}\delta_{ij}\partial_j n_v(\mathbf r) 
    \label{eq:diff-jv}  
\end{equation}
where $\sigma_{c,xy}$ and $D_{v,xx}$ are scalars


\subsection{Laplace equation}

Now that we have the charge and valley currents differential equations we calculate the laplacians to solve them. Let's start from the equation for the charge currents \ref{eq:diff-jc}

\begin{equation}
    \nabla \cdot \vect J_c=\nabla \cdot (\sigma_c \mathbf E)+ eD_{cv,xx}\nabla \cdot (\nabla\times n_v)
    \label{eq:lap-jc}
\end{equation}
Inside the material the are no sources of charge current, so $\nabla \cdot \vect J_c=$, and the divergence of a rotor is zero, so $\nabla \cdot (\nabla\times n_v)=0$. This means that inside the material
\begin{equation}
    \boxed{
    \nabla^2 V(x,y)=0
    }
\end{equation}
So, to be able to solve the laplace equation we just need to impose the boundary conditions that the current is injected in a single point at $x=0$ along the $\hat{\vect y}$ direction. 
\[
    -e\vect J_c(x,\pm W/2)=I\delta(x)\hat{\vect y}    
\]
If we put it in equation \ref{eq:lap-jc} we get
\begin{equation}
    \boxed{
        I\delta(x)=\sigma_{c,xx}\partial_y V(x,\pm W/2)-eD_{cv,xy}\partial_x n_v(x,\pm W/2)
    }
\end{equation}
Now let's calculate the laplacian for the valley current equation \ref{eq:diff-jv}


\begin{equation}
    \nabla \cdot \mathbf J_v=\nabla \times (\sigma_{c,xy} \mathbf E)+ e\nabla \cdot (D_{v,xx}\nabla n_v)
\end{equation}
Now, lets analyze all the terms one by one
\begin{itemize}
\item For the continuity equation we have that $\nabla \cdot \mathbf J_v=\frac \partial {\partial t} n_v$, since intervalley scattering is zero, this should be zero, but  why don't add it back now? so we say that it decays exponentially $\frac \partial {\partial t} n_v=-\frac 1 {\tau_v} n_v$
\item$e\nabla \cdot (D_{v,xx}\nabla n_v)$ is really nothing special, inside the material $D_{v,xx}$ is constsant so in the end it is equal to $eD_{v,xx}\nabla^2 n_v$
\item $\nabla \times (\sigma_{c,xy} \mathbf E)$ is equal to zero inside the material, but on the edge can be non-zero because $\sigma_{c,xy}$ changes form inside to the outside
\end{itemize}
In the end we get that


\begin{equation}
    eD_{v,xx}\nabla^2n_v=-\frac 1{\tau_v}n_v- \nabla \times (\sigma_{c,xy} \mathbf E)
\end{equation}
This means that at the equilibrium $n_v\neq 0$ only if you are were $\nabla\times (\sigma_{c,xy} \mathbf E)\neq 0$, and this is only true along the edge, so we we'll have to worry about this term only in the boundary conditions, So

\begin{equation}
    \boxed{\bigg[
        \nabla^2 -\frac 1{\tau_v D_{v,xx}}
        \bigg]
    n_v(\vect r)=0}
\end{equation}
The boundary condition is simply that the valley current doesn't exit the material, so
\begin{equation}
    J_{v,y}(x,\pm W/2)=0
\end{equation}
putting it into the differential equation for $J_v$ (eq \ref{eq:diff-jv}) we get
\begin{equation}
    \boxed{
        \sigma_{v,xy}\partial_x V(x,\pm W/2)+eD_{v,xx}\partial_y n_v(x,\pm W/2)=0
    }
\end{equation}


All the boxed equations we wrote in the in this section enable us to completely solve the system. For convenience let's write the m in a single system of equations

\begin{equation}
    \begin{cases}
        \nabla^2 V(x,y)=0\\
        \bigg[\nabla^2 -\frac 1{\tau_v D_{v,xx}}\bigg]n_v(\vect r)=0\\
        I\delta(x)=\sigma_{c,xx}\partial_y V(x,\pm W/2)-eD_{cv,xy}\partial_x n_v(x,\pm W/2)\\
        \sigma_{v,xy}\partial_x V(x,\pm W/2)+eD_{v,xx}\partial_y n_v(x,\pm W/2)=0
    \end{cases}
    \label{eq:syst1}
\end{equation}
From the third equation in the system above we can see that $V(x,y)$ is even along the $\hat{\vect x}$ axis and odd along the $\hat{\vect y}$ axis.\newline
From the fourth equation we can see that $n_v$ has the opposite parity to $V$, so it's odd along the $\hat{\vect x}$ axis and even along the $\hat{\vect y}$ axis.\newline

To be able to solve it we first have to do a fourier transform over the $\hat{\vect x}$ direction. The first two equations of eq \ref{eq:syst1} become 


\begin{equation}
    \begin{cases}
        (\partial_y^2 - k^2) V(k,y)=0\\
        \big[\partial_y^2 -\omega^2(k)\big]n_v(k,y)=0
    \end{cases}
\end{equation}
And the solutions that respect the symmetries we talked about earlier are
\begin{equation}
    V(k,y)=V(k)\sinh (ky) \quad \quad n_v(k,y)=n_v(k)\cosh [\omega(k)y]
    \label{eq:separation}
\end{equation}
However we still don't know what are $V(k)$ and $n_v(k)$, to obtain them we have to plug the equations above in the last two equations of \ref{eq:syst1}
\begin{equation}
    \begin{cases}
        \sigma_{c,xx}k\cosh(kw/2) V(k)-eD_{cv,xy}ik \cosh(\omega W/2)n_v(k)=I\\
        -\sigma_{v,xy} ik \sinh(kw/2) V(k)-eD_{v,xx}\omega(k)\sinh(\omega W/2) n_v(k)=0
    \end{cases}
\end{equation}
This system of equation is linear in $V(k)$ and $n_v(k)$, so it can be written in this form
\begin{equation}
    \begin{bmatrix}
        A&B\\
        C&D
    \end{bmatrix}
    \begin{bmatrix}
        V\\n_v
    \end{bmatrix}=
    \begin{bmatrix}
        I\\0
    \end{bmatrix}
\end{equation}
And the inverse is simply
\begin{equation}
    \begin{bmatrix}
        V\\n_v
    \end{bmatrix}=
    \frac I{AD-BC}
    \begin{bmatrix}
        D\\-C
    \end{bmatrix}
\end{equation}
Since we want only care to calculate the voltage we only need to evaluate
\[
    V=\frac{I}{A-\frac{BC}D}    
\]
wich turns out to be equal to
\begin{equation}
    V(k)=\frac I{\sigma_c}\frac{\omega(k)/k}{\sinh(kW/2)}
    \bigg\{
        \frac{\omega(k)}{\tanh(kW/2)} + \frac{k\tan^2(\theta_{VH})}{\tanh[\omega(k)W/2]}    
    \bigg\}^{-1}
    \label{eq:vk}
\end{equation}
We can plug it into equation \ref{eq:separation} and evaluate it at $y=\pm W/2$

\begin{equation}
    V(k,\pm W/2)=V(k)\sinh(\pm kW/2)=\frac{I\omega}{\sigma_c k}\bigg\{\dots\bigg\}^{-1}
\end{equation}
Where the terms inside the curly brakets are the same from the previous equation (\ref{eq:vk}).\\
Finally we can calculate the non-local resistance

\begin{equation}
    R_{NL}(k)=\frac{V(k,W/2)-V(k,-W/2)}I
\end{equation}
Which is equal to

\begin{equation}
    R_{NL}(k)=\frac{2\omega(k)}{k\sigma_c}
    \bigg\{
        \frac{\omega(k)}{\tanh(kW/2)} + \frac{k\tan^2(\theta_{VH})}{\tanh[\omega(k)W/2]}    
    \bigg\}^{-1}
   % \label{eq:rnlk}
\end{equation}


